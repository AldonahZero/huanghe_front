# 项目详情页面 - 核心功能文档

## 功能概述

项目详情页面是本系统的核心功能,用于展示爬虫数据的深度分析结果。用户点击仪表盘上的饰品卡片后,会进入该项目的详细分析页面。

## 页面路由

- **路由**: `/dashboard/project/[id]`
- **示例**: `/dashboard/project/ak_redline`

## 核心功能模块

### 1. 求购数据分析

#### 前30名求购者展示
- **头像**: 显示用户头像
- **用户名**: 当前用户名(可变)
- **用户ID**: 永久不变的唯一标识
- **求购次数**: 统计时间范围内的求购总数
- **交互**: 点击用户卡片可查看其位次分布

#### 频繁求购者位次分布
- 展示求购频繁的用户在前30名中的位置分布
- 可视化显示每个位次出现的频率
- 自动显示前5名最活跃用户,或显示被选中的用户

**示例数据**:
```typescript
{
  userId: "user_1001",
  userName: "玩家A",
  positions: [
    { position: 1, count: 15 },  // 第1位出现15次
    { position: 3, count: 8 },   // 第3位出现8次
    { position: 5, count: 5 }    // 第5位出现5次
  ],
  totalOrders: 28
}
```

### 2. 在售数据分析

#### 前30名挂售者展示
- **头像**: 显示卖家头像
- **用户名**: 当前用户名(可变)
- **用户ID**: 永久不变的唯一标识
- **挂售次数**: 统计时间范围内的挂售总数

### 3. 成交列表分析

成交数据通过三个维度展示:

#### a. 买入排行
- 展示买入次数最多的用户
- 同时显示该用户的卖出次数
- 排序依据: 买入次数降序

#### b. 卖出排行
- 展示卖出次数最多的用户
- 同时显示该用户的买入次数
- 排序依据: 卖出次数降序

#### c. 交易关系分析
展示用户之间的交易关系,包括:
- **双向交易统计**: 用户A买B多少次,用户B买A多少次
- **总交易次数**: 两个用户之间的所有交易
- **筛选条件**: 只显示交易3次以上的用户对

**示例展示**:
```
玩家A (user_1001) ⇄ 玩家B (user_1023)
├─ 玩家A 从 玩家B 买入: 8次
├─ 玩家B 从 玩家A 买入: 5次
└─ 总交易: 13次
```

## 时间范围选择器

支持以下时间范围:
- 最近1小时
- 最近6小时
- 最近12小时
- 最近24小时 (默认)
- 最近48小时
- 最近72小时

切换时间范围会自动重新分析数据并更新所有图表。

## 数据更新频率

- **采集频率**: 每小时采集一次数据
- **数据快照**: 每小时保存当时的前30名求购者、前30名挂售者和成交记录
- **历史数据**: 默认保留72小时的历史数据

## 技术实现

### 文件结构
```
app/dashboard/project/[id]/
  └─ page.tsx                    # 项目详情页面主组件

components/
  ├─ BuyOrdersSection.tsx        # 求购数据展示组件
  ├─ SellListingsSection.tsx     # 在售数据展示组件
  ├─ TransactionsSection.tsx     # 成交分析组件
  └─ TimeRangeSelector.tsx       # 时间选择器组件

lib/
  └─ projectAnalysis.ts          # 数据分析逻辑

types/
  └─ project.ts                  # TypeScript 类型定义
```

### 核心数据结构

#### 用户信息
```typescript
interface UserProfile {
  userId: string;      // 永久ID
  userName: string;    // 可变名称
  avatarUrl?: string;  // 头像
}
```

#### 每小时数据快照
```typescript
interface HourlyData {
  timestamp: number;              // 时间戳
  buyOrders: BuyOrder[];          // 前30名求购者
  sellListings: SellListing[];    // 前30名挂售者
  transactions: Transaction[];    // 该小时的成交记录
}
```

#### 成交记录
```typescript
interface Transaction {
  transactionId: string;
  buyerId: string;     // 买家ID
  sellerId: string;    // 卖家ID
  price: number;
  timestamp: number;
}
```

### 数据分析算法

#### 1. 求购位次分布计算
```typescript
// 遍历所有小时数据
for each hourData in timeRange:
  for each buyOrder in hourData.buyOrders:
    记录 userId 和 position
    
// 统计每个用户在各个位次出现的次数
for each userId:
  count[position] = 该用户在该位次出现的次数
```

#### 2. 交易对关系计算
```typescript
// 遍历所有成交记录
for each transaction:
  pairKey = sort([buyerId, sellerId]).join(":")
  
  if buyer == userId1 and seller == userId2:
    user1BoughtFromUser2++
  if buyer == userId2 and seller == userId1:
    user2BoughtFromUser1++
    
// 筛选交易次数 >= 3 的交易对
activePairs = pairs.filter(p => p.totalTransactions >= 3)
```

## 使用说明

### 1. 从仪表盘进入
1. 打开仪表盘页面 `/dashboard`
2. 点击任意饰品卡片
3. 自动跳转到 `/dashboard/project/{项目ID}`

### 2. 查看求购数据
1. 滚动到"求购数据分析"部分
2. 浏览前30名求购者列表
3. 点击任意用户查看其位次分布详情

### 3. 分析成交数据
1. 滚动到"成交数据分析"部分
2. 切换标签页查看:
   - 买入排行
   - 卖出排行
   - 交易关系
3. 在交易关系页面找到频繁交易的用户对

### 4. 调整时间范围
1. 使用页面顶部的时间选择器
2. 点击不同的时间范围按钮
3. 系统自动重新计算并更新所有数据

## 数据展示特点

### 视觉设计
- **求购数据**: 蓝色主题
- **在售数据**: 绿色主题
- **成交数据**: 紫色主题

### 交互特性
- 卡片悬停高亮
- 点击用户展开详情
- 标签页切换动画
- 返回按钮支持浏览器后退

### 性能优化
- 数据按需分析
- 组件懒加载
- 虚拟滚动(长列表)

## 未来扩展

可能的功能扩展方向:
1. **实时数据推送**: 使用 WebSocket 实现实时更新
2. **价格趋势图**: 展示价格随时间的变化
3. **用户行为预测**: 基于历史数据预测用户行为
4. **导出报告**: 将分析结果导出为 PDF/Excel
5. **对比分析**: 同时对比多个项目的数据
6. **告警系统**: 当价格或交易量异常时发送通知

## 注意事项

1. **用户ID vs 用户名**: 
   - 用户ID永远不变,用作数据关联的唯一标识
   - 用户名可能会变,仅用于显示

2. **数据精度**: 
   - 所有统计数据基于每小时的快照
   - 不是精确到秒的实时数据

3. **性能考虑**:
   - 大时间范围(72小时)可能需要较长的计算时间
   - 建议默认使用24小时范围

4. **数据完整性**:
   - 如果某个小时数据缺失,分析会跳过该时段
   - 位次统计可能存在空缺(例如某用户只在1、5、10位出现过)
