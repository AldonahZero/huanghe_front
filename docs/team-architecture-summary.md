# å›¢é˜Ÿç®¡ç†åŠŸèƒ½æ¶æ„æ€»ç»“

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

å›¢é˜Ÿç®¡ç†åŠŸèƒ½é‡‡ç”¨**ä¸¤å±‚æ¶æ„è®¾è®¡**,ä¸ºç®¡ç†å‘˜å’Œè€å¸ˆæä¾›äº†æ¸…æ™°çš„å›¢é˜Ÿç®¡ç†ç•Œé¢ã€‚

```
ä¾§è¾¹æ  "å›¢é˜Ÿç®¡ç†" 
    â†“
å›¢é˜Ÿåˆ—è¡¨é¡µ (/dashboard/teams)
    â”œâ”€ ç®¡ç†å‘˜: çœ‹åˆ°æ‰€æœ‰å›¢é˜Ÿå¡ç‰‡
  â””â”€ è€å¸ˆ: åªçœ‹åˆ°è‡ªå·±çš„å›¢é˜Ÿå¡ç‰‡
        â†“ ç‚¹å‡»å›¢é˜Ÿå¡ç‰‡
å›¢é˜Ÿè¯¦æƒ…é¡µ (/dashboard/teams/[id])
    â”œâ”€ å›¢é˜Ÿä¿¡æ¯ç¼–è¾‘
    â”œâ”€ å›¢é˜Ÿå¤´åƒç®¡ç†
    â””â”€ é‚€è¯·ç ç®¡ç†
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### ç¬¬ä¸€å±‚: å›¢é˜Ÿåˆ—è¡¨é¡µ
**è·¯ç”±**: `/dashboard/teams`  
**æ–‡ä»¶**: `app/dashboard/teams/page.tsx`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… å¡ç‰‡å¼å±•ç¤ºå›¢é˜Ÿåˆ—è¡¨
- âœ… æ˜¾ç¤ºå›¢é˜Ÿå¤´åƒã€åç§°ã€æè¿°ã€æˆå‘˜æ•°é‡
- âœ… ç®¡ç†å‘˜æƒé™: çœ‹åˆ°æ‰€æœ‰å›¢é˜Ÿ
- âœ… è€å¸ˆæƒé™: åªçœ‹åˆ°è‡ªå·±åˆ›å»ºçš„å›¢é˜Ÿ
- âœ… ç‚¹å‡»å¡ç‰‡è·³è½¬åˆ°å›¢é˜Ÿè¯¦æƒ…é¡µ
- âœ… åˆ·æ–°æŒ‰é’®

**UI ç»„ä»¶**:
- Card å¡ç‰‡å¸ƒå±€
- Avatar å¤´åƒæ˜¾ç¤º
- Grid ç½‘æ ¼å¸ƒå±€(å“åº”å¼)
- æ‚¬åœæ•ˆæœå’Œè¿‡æ¸¡åŠ¨ç”»

### ç¬¬äºŒå±‚: å›¢é˜Ÿè¯¦æƒ…é¡µ
**è·¯ç”±**: `/dashboard/teams/[id]`  
**æ–‡ä»¶**: `app/dashboard/teams/[id]/page.tsx`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æŸ¥çœ‹å’Œç¼–è¾‘å›¢é˜Ÿä¿¡æ¯(åç§°ã€æè¿°)
- âœ… ä¸Šä¼ å’Œç®¡ç†å›¢é˜Ÿå¤´åƒ(æ”¯æŒæ–‡ä»¶ä¸Šä¼ )
- âœ… ç”Ÿæˆå›¢é˜Ÿé‚€è¯·ç (é…ç½®æ¬¡æ•°å’Œæœ‰æ•ˆæœŸ)
- âœ… æŸ¥çœ‹å’Œå¤åˆ¶é‚€è¯·ç 
- âœ… è¿”å›å›¢é˜Ÿåˆ—è¡¨æŒ‰é’®

**ç¼–è¾‘æµç¨‹**:
1. ç‚¹å‡»"ç¼–è¾‘ä¿¡æ¯"è¿›å…¥ç¼–è¾‘æ¨¡å¼
2. ä¿®æ”¹å›¢é˜Ÿä¿¡æ¯ / ä¸Šä¼ å¤´åƒ
3. ç‚¹å‡»"ä¿å­˜æ›´æ”¹"æäº¤
4. æ˜¾ç¤ºæˆåŠŸæç¤º,é€€å‡ºç¼–è¾‘æ¨¡å¼

## ğŸ” æƒé™æ§åˆ¶

### è§’è‰²æƒé™è¡¨

| è§’è‰² | å›¢é˜Ÿåˆ—è¡¨è®¿é—® | å¯è§å›¢é˜ŸèŒƒå›´ | å›¢é˜Ÿç¼–è¾‘æƒé™ |
|------|------------|------------|------------|
| ç®¡ç†å‘˜ | âœ… | æ‰€æœ‰å›¢é˜Ÿ | æ‰€æœ‰å›¢é˜Ÿ |
| è€å¸ˆ | âœ… | è‡ªå·±çš„å›¢é˜Ÿ | è‡ªå·±çš„å›¢é˜Ÿ |
| æ™®é€šæˆå‘˜ | âŒ | æ—  | æ—  |

### æƒé™å®ç°

**ä¾§è¾¹æ èœå•** (`DashboardSidebar.tsx`):
```typescript
...(user?.role === "admin" || user?.role === "teacher" 
  ? [teamSettingItem] 
  : [])
```

**é¡µé¢çº§æƒé™æ£€æŸ¥**:
```typescript
const hasPermission = user?.role === "admin" || user?.role === "teacher";

if (!hasPermission) {
  return <AccessDenied />;
}
```

## ğŸŒ API æ¥å£

### æ–°å¢æ¥å£

#### 1. è·å–å›¢é˜Ÿåˆ—è¡¨
```typescript
GET /api/teams

// è¿”å›å€¼æ ¹æ®ç”¨æˆ·è§’è‰²:
// - ç®¡ç†å‘˜: æ‰€æœ‰å›¢é˜Ÿ
// - æ•™å¸ˆ: è‡ªå·±çš„å›¢é˜Ÿ
```

#### 2. è·å–æŒ‡å®šå›¢é˜Ÿä¿¡æ¯
```typescript
GET /api/team/{teamId}/info
```

#### 3. æ›´æ–°æŒ‡å®šå›¢é˜Ÿä¿¡æ¯
```typescript
PUT /api/team/{teamId}/info
Body: { name?, description?, avatar_url? }
```

#### 4. ç”Ÿæˆå›¢é˜Ÿé‚€è¯·ç 
```typescript
POST /api/team/{teamId}/invite-code
Body: { uses_allowed?, expires_in_days? }
```

#### 5. è·å–å›¢é˜Ÿé‚€è¯·ç åˆ—è¡¨
```typescript
GET /api/team/{teamId}/invite-codes
```

### API å‡½æ•° (lib/api.ts)
| è€å¸ˆ | âœ… | è‡ªå·±çš„å›¢é˜Ÿ | è‡ªå·±çš„å›¢é˜Ÿ |
```typescript
// æ–°å¢
getTeams(): Promise<{ teams: TeamInfo[] }>

// ä¿®æ”¹(æ·»åŠ  teamId å‚æ•°)
getTeamInfo(teamId: number): Promise<{ team: TeamInfo }>
updateTeamInfo(teamId: number, data): Promise<{ message, team }>
generateInviteCode(teamId: number, data): Promise<{ message, invite_code }>
getInviteCodes(teamId: number): Promise<{ invite_codes }>
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
app/
  dashboard/
    teams/
      page.tsx              # å›¢é˜Ÿåˆ—è¡¨é¡µ
      [id]/
        page.tsx            # å›¢é˜Ÿè¯¦æƒ…é¡µ

components/
  DashboardSidebar.tsx      # ä¾§è¾¹æ (å¸¦æƒé™æ§åˆ¶)
  DashboardTopbar.tsx       # é¡¶æ (å¸¦æ ‡é¢˜æ˜ å°„)

lib/
  api.ts                    # API å®¢æˆ·ç«¯(å›¢é˜Ÿç›¸å…³å‡½æ•°)

docs/
  team-settings-implementation.md   # è¯¦ç»†å®ç°æ–‡æ¡£
  team-architecture-summary.md      # æœ¬æ–‡æ¡£
```

## ğŸ¨ UI/UX äº®ç‚¹

### å›¢é˜Ÿåˆ—è¡¨é¡µ
- ğŸ“± å“åº”å¼å¡ç‰‡ç½‘æ ¼å¸ƒå±€
- ğŸ¯ æ‚¬åœæ•ˆæœ(é˜´å½± + å¤´åƒè¾¹æ¡†é«˜äº®)
- ğŸ”„ åŠ è½½çŠ¶æ€å’Œç©ºçŠ¶æ€å¤„ç†
- âš¡ åˆ·æ–°æŒ‰é’®(å¸¦åŠ è½½åŠ¨ç”»)

### å›¢é˜Ÿè¯¦æƒ…é¡µ
- ğŸ”™ è¿”å›æŒ‰é’®(é¡¶éƒ¨æ˜¾è‘—ä½ç½®)
- ğŸ–¼ï¸ å¤´åƒä¸Šä¼ (ç‚¹å‡»å¼,å¸¦é¢„è§ˆ)
- ğŸ“ ç¼–è¾‘æ¨¡å¼åˆ‡æ¢(æ¸…æ™°çš„ä¿å­˜/å–æ¶ˆæŒ‰é’®)
- ğŸ“‹ é‚€è¯·ç å¤åˆ¶(ä¸€é”®å¤åˆ¶,è§†è§‰åé¦ˆ)
- ğŸ·ï¸ çŠ¶æ€æ ‡ç­¾(å¯ç”¨/å·²ç”¨å®Œ)

## ğŸš€ ä½¿ç”¨æµç¨‹ç¤ºä¾‹

### ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰å›¢é˜Ÿå¹¶ç¼–è¾‘
1. ç™»å½•ååœ¨ä¾§è¾¹æ ç‚¹å‡»"å›¢é˜Ÿç®¡ç†"
2. çœ‹åˆ°æ‰€æœ‰å›¢é˜Ÿçš„å¡ç‰‡åˆ—è¡¨
3. ç‚¹å‡»æŸä¸ªå›¢é˜Ÿå¡ç‰‡
4. è¿›å…¥è¯¥å›¢é˜Ÿçš„è¯¦æƒ…é¡µ
5. ç‚¹å‡»"ç¼–è¾‘ä¿¡æ¯"ä¿®æ”¹å›¢é˜Ÿä¿¡æ¯
6. ç‚¹å‡»"ç”Ÿæˆé‚€è¯·ç "åˆ›å»ºæ–°é‚€è¯·ç 
7. ç‚¹å‡»"å¤åˆ¶"æŒ‰é’®å¤åˆ¶é‚€è¯·ç 
8. ç‚¹å‡»"è¿”å›å›¢é˜Ÿåˆ—è¡¨"å›åˆ°åˆ—è¡¨é¡µ

### è€å¸ˆç®¡ç†è‡ªå·±çš„å›¢é˜Ÿ
1. ç™»å½•ååœ¨ä¾§è¾¹æ ç‚¹å‡»"å›¢é˜Ÿç®¡ç†"
2. åªçœ‹åˆ°è‡ªå·±åˆ›å»ºçš„å›¢é˜Ÿå¡ç‰‡
3. ç‚¹å‡»å›¢é˜Ÿå¡ç‰‡è¿›å…¥è¯¦æƒ…é¡µ
4. ä¸Šä¼ å›¢é˜Ÿå¤´åƒ,ä¿®æ”¹å›¢é˜Ÿä¿¡æ¯
5. ç”Ÿæˆé‚€è¯·ç åˆ†äº«ç»™å­¦ç”Ÿ
6. å®Œæˆåè¿”å›åˆ—è¡¨é¡µ

## âš™ï¸ æŠ€æœ¯æ ˆ

- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript
- **UI Library**: shadcn/ui
- **Icons**: lucide-react
- **Styling**: Tailwind CSS
- **State**: React Hooks (useState, useEffect, useRef)
- **Routing**: Next.js Dynamic Routes
- **Auth**: AuthContext (useAuth hook)

## âœ… å·²å®ŒæˆåŠŸèƒ½æ¸…å•

- [x] å›¢é˜Ÿåˆ—è¡¨é¡µé¢ UI
- [x] å›¢é˜Ÿè¯¦æƒ…é¡µé¢ UI
- [x] æƒé™æ§åˆ¶(ç®¡ç†å‘˜/è€å¸ˆ)
- [x] API å‡½æ•°(getTeams, getTeamInfo, ç­‰)
- [x] å›¢é˜Ÿä¿¡æ¯ç¼–è¾‘
- [x] å›¢é˜Ÿå¤´åƒä¸Šä¼ 
- [x] é‚€è¯·ç ç”Ÿæˆ
- [x] é‚€è¯·ç åˆ—è¡¨å±•ç¤º
- [x] é‚€è¯·ç å¤åˆ¶åŠŸèƒ½
- [x] å¯¼èˆªå’Œè·¯ç”±
- [x] å“åº”å¼å¸ƒå±€
- [x] åŠ è½½çŠ¶æ€å¤„ç†
- [x] é”™è¯¯å¤„ç†
- [x] æ–‡æ¡£ç¼–å†™

## ğŸ”œ åç»­ä¼˜åŒ–å»ºè®®

1. **å¤´åƒä¸Šä¼ å¢å¼º**
   - å®ç°çœŸå®çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨
   - æ·»åŠ å›¾ç‰‡è£å‰ªåŠŸèƒ½
   - æ”¯æŒæ‹–æ‹½ä¸Šä¼ 

2. **é‚€è¯·ç åŠŸèƒ½æ‰©å±•**
   - æ˜¾ç¤ºé‚€è¯·ç ä½¿ç”¨è®°å½•
   - æ·»åŠ åˆ é™¤é‚€è¯·ç åŠŸèƒ½
   - é‚€è¯·ç è¿‡æœŸæé†’

3. **å›¢é˜Ÿç®¡ç†æ‰©å±•**
   - å›¢é˜Ÿæˆå‘˜åˆ—è¡¨æŸ¥çœ‹
   - æˆå‘˜è§’è‰²ç®¡ç†
   - æˆå‘˜ç§»é™¤åŠŸèƒ½

4. **æœç´¢å’Œç­›é€‰**
   - å›¢é˜Ÿåˆ—è¡¨æœç´¢
   - æŒ‰æˆå‘˜æ•°é‡ç­›é€‰
   - æŒ‰åˆ›å»ºæ—¶é—´æ’åº

5. **ç»Ÿè®¡ä¿¡æ¯**
   - å›¢é˜Ÿæ´»è·ƒåº¦ç»Ÿè®¡
   - é‚€è¯·ç ä½¿ç”¨æƒ…å†µåˆ†æ
   - æˆå‘˜å¢é•¿è¶‹åŠ¿

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å›¢é˜Ÿè®¾ç½®è¯¦ç»†å®ç°æ–‡æ¡£](./team-settings-implementation.md)
- [ç”¨æˆ·ä¿¡æ¯å®ç°æ–‡æ¡£](./user-profile-implementation.md)
- [å¤´åƒä¸Šä¼ å®ç°æ–‡æ¡£](./avatar-upload-implementation.md)

## åç«¯å¯¹æ¥: invites å­—æ®µæœŸæœ›è¯´æ˜

å‰ç«¯åœ¨å›¢é˜Ÿè¯¦æƒ…é¡µä¼šä¼˜å…ˆä½¿ç”¨ `GET /api/teams/<team_id>` è¿”å›ä½“ä¸­çš„ `invites` å­—æ®µï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™å›é€€åˆ°å•ç‹¬çš„ `GET /api/team/{teamId}/invite-codes`ã€‚è¯·åç«¯ç¡®ä¿ `invites` æˆ– `invite_codes` ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

ç¤ºä¾‹:

```json
{
  "team": { /* ... */ },
  "members": [ /* ... */ ],
  "invites": [
    {
      "code": "ABC123",
      "uses_allowed": 3,
      "uses_remaining": 2,
      "expires_at": null,
      "created_by_admin_id": 1,
      "assigned_to_user_id": null,
      "is_active": true,
      "created_at": "2025-10-13T10:31:00",
      "member_level": "core"
    }
  ]
}
```

å­—æ®µè¯´æ˜ï¼ˆinvites / invite_codesï¼‰:

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | string | é‚€è¯·ç æ–‡æœ¬ |
| uses_allowed | integer | å…è®¸çš„æœ€å¤§ä½¿ç”¨æ¬¡æ•° |
| uses_remaining | integer | å‰©ä½™å¯ç”¨æ¬¡æ•° |
| expires_at | string|null | è¿‡æœŸæ—¶é—´ï¼ˆISO 8601ï¼Œæˆ– null è¡¨ç¤ºä¸è¿‡æœŸï¼‰ |
| created_by_admin_id | integer|null | åˆ›å»ºè¯¥é‚€è¯·ç çš„ç®¡ç†å‘˜ IDï¼ˆå¯ä¸º nullï¼‰ |
| assigned_to_user_id | integer|null | å¦‚æœè¯¥é‚€è¯·ç è¢«æŒ‡å®šç»™æŸä½ç”¨æˆ·ä½¿ç”¨ï¼Œå¡«å†™è¯¥ç”¨æˆ· IDï¼Œå¦åˆ™ä¸º null |
| is_active | boolean | å½“å‰é‚€è¯·ç æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼ˆtrue/falseï¼‰ |
| created_at | string | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601ï¼‰ |
| member_level | string|null | å¯é€‰ï¼šæ­¤é‚€è¯·ç åˆ†é…ç»™æ–°ç”¨æˆ·çš„ä¼šå‘˜ç­‰çº§ï¼ˆè§ä¸‹æ–¹æšä¸¾ï¼‰ï¼Œè‹¥æ— åˆ™ä¸º null |

å…³äº `member_level` çš„å››ç§å–å€¼ï¼ˆåç«¯éœ€ä¿è¯ä½¿ç”¨ä¸‹åˆ—å€¼ä¹‹ä¸€ï¼‰:

| å€¼ | å«ä¹‰ |
|-----|------|
| emperor | emperorï¼ˆæœ€é«˜çº§åˆ«ï¼‰ |
| private_director | private_directorï¼ˆç§è‘£ / ç§äººè‘£äº‹ç±»æƒé™ï¼‰ |
| core | coreï¼ˆæ ¸å¿ƒä¼šå‘˜ï¼‰ |
| normal | normalï¼ˆæ™®é€šä¼šå‘˜ï¼‰ |

å…¼å®¹æ€§è¯´æ˜:
- å¦‚æœåç«¯ä½¿ç”¨ä¸åŒå­—æ®µåï¼ˆä¾‹å¦‚ `level` æˆ– `assign_level`ï¼‰ï¼Œè¯·å‘ŠçŸ¥å‰ç«¯ä»¥ä¾¿åŒæ­¥æ›´æ–°ã€‚
- å»ºè®®åç«¯åŒæ—¶è¿”å›ä¸€ä¸ª `member_level_display` å­—æ®µä»¥æä¾›æœ¬åœ°åŒ–å‹å¥½åç§°ï¼ˆå¯é€‰ï¼‰ã€‚

---

### ç®¡ç†å‘˜ & è€å¸ˆç›¸å…³æ¥å£è¡¥å……ï¼ˆç®€è¦ï¼‰

ä¸ºäº†ä¾¿äºåç«¯å¿«é€Ÿå¯¹æ¥ï¼Œä»¥ä¸‹æ˜¯å‰ç«¯è¿‘æœŸéœ€è¦åç«¯ç¡®è®¤å¹¶æ”¯æŒçš„ä¸‰ä¸ªæ¥å£è¦ç‚¹ï¼š

- POST `/api/admin/teams/<team_id>/invites`ï¼ˆç®¡ç†å‘˜åˆ›å»ºé‚€è¯·ç ï¼‰
  - æ¥æ”¶è¯·æ±‚ä½“ä¸­å¯é€‰çš„ `member_level` å­—æ®µå¹¶ä¿å­˜
  - æˆåŠŸè¿”å›çš„ `invite` å¯¹è±¡åº”åŒ…å« `member_level`ï¼ˆè‹¥æ•°æ®åº“ä¸­å­˜åœ¨ï¼‰

- GET `/api/teams/<team_id>`ï¼ˆå›¢é˜Ÿè¯¦æƒ…ï¼‰
  - è¿”å›ä½“ä¸­çš„ `invites` æ•°ç»„è‹¥åµŒå…¥ invitesï¼Œåº”åŒ…å« `member_level` å­—æ®µ

- GET `/api/teachers/<teacher_id>/invites`ï¼ˆè€å¸ˆç»´åº¦é‚€è¯·åˆ—è¡¨ï¼Œå¯é€‰ï¼‰
  - è¿”å›çš„ invite é¡¹ä¹Ÿåº”åŒ…å« `member_level` å­—æ®µï¼ˆè‹¥æ•°æ®åº“ä¸­å­˜åœ¨ï¼‰

ç¤ºä¾‹å’Œæ›´è¯¦ç»†çš„å­—æ®µè¯´æ˜è§ `docs/team-settings-implementation.md` ä¸­â€œå‰ç«¯å¯¹ invites å­—æ®µçš„æœŸæœ›è¯´æ˜â€éƒ¨åˆ†ã€‚

---

**æœ€åæ›´æ–°**: 2025-10-13  
**ç‰ˆæœ¬**: 2.0 (ä¸¤å±‚æ¶æ„)  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶å¯ç”¨
